### ========================================
### Google Sheets Integration Tests
### Canada Immigration Application
### ========================================

### Variables
@baseUrl = http://localhost:3000
@contentType = application/json

### ========================================
### Test 1: Create Client - Basic Information
### This will create a client and send data to Google Sheets
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "phone": "+1-416-555-0001",
  "immigrationType": "skilled-worker"
}

### ========================================
### Test 2: Create Client - Complete Information
### Full client data with all optional fields
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Jane Smith",
  "email": "jane.smith@example.com",
  "phone": "+1-416-555-0002",
  "passportNumber": "CA123456789",
  "nationality": "Canadian",
  "dateOfBirth": "1985-05-15",
  "address": "123 Maple Street, Toronto, ON M5V 2T6, Canada",
  "immigrationType": "express-entry",
  "notes": "Applying for permanent residence through Express Entry"
}

### ========================================
### Test 3: Create Multiple Clients - Batch Test
### Test 1: Student Visa
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Ahmed Hassan",
  "email": "ahmed.hassan@example.com",
  "phone": "+1-647-555-0003",
  "passportNumber": "EG987654321",
  "nationality": "Egyptian",
  "dateOfBirth": "1998-08-20",
  "address": "456 University Ave, Toronto, ON",
  "immigrationType": "student-visa",
  "notes": "Enrolled at University of Toronto for Master's program"
}

### ========================================
### Test 4: Family Sponsorship
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Maria Garcia",
  "email": "maria.garcia@example.com",
  "phone": "+1-905-555-0004",
  "passportNumber": "MX456789123",
  "nationality": "Mexican",
  "dateOfBirth": "1990-12-10",
  "address": "789 Family Lane, Mississauga, ON",
  "immigrationType": "family-sponsorship",
  "notes": "Being sponsored by spouse who is Canadian citizen"
}

### ========================================
### Test 5: Business Immigration
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Li Wei",
  "email": "li.wei@example.com",
  "phone": "+1-416-555-0005",
  "passportNumber": "CN789123456",
  "nationality": "Chinese",
  "dateOfBirth": "1975-03-25",
  "address": "321 Business Blvd, Markham, ON",
  "immigrationType": "business-investor",
  "notes": "Entrepreneur stream - Tech startup investment of $500K"
}

### ========================================
### Test 6: Refugee Claim
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Fatima Al-Rashid",
  "email": "fatima.alrashid@example.com",
  "phone": "+1-647-555-0006",
  "passportNumber": "SY654321987",
  "nationality": "Syrian",
  "dateOfBirth": "1992-07-18",
  "address": "555 Refuge Street, Toronto, ON",
  "immigrationType": "refugee",
  "notes": "Humanitarian grounds - Convention refugee claim"
}

### ========================================
### Test 7: Temporary Work Permit
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Carlos Rodriguez",
  "email": "carlos.rodriguez@example.com",
  "phone": "+1-416-555-0007",
  "passportNumber": "BR321654987",
  "nationality": "Brazilian",
  "dateOfBirth": "1988-11-30",
  "address": "888 Worker Way, Brampton, ON",
  "immigrationType": "work-permit",
  "notes": "LMIA-based work permit - Software engineer position"
}

### ========================================
### Test 8: Create Client with Special Characters
### Test data sanitization and encoding
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "François Müller",
  "email": "francois.muller@example.com",
  "phone": "+1-514-555-0008",
  "passportNumber": "FR789456123",
  "nationality": "French",
  "dateOfBirth": "1982-04-12",
  "address": "999 Rue François-Xavier, Montréal, QC H2Y 2Z1",
  "immigrationType": "skilled-worker",
  "notes": "Bilingual applicant - French & English proficiency"
}

### ========================================
### Test 9: Create Client with Long Address
### Test cell truncation/wrapping
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rajesh Kumar",
  "email": "rajesh.kumar@example.com",
  "phone": "+1-905-555-0009",
  "passportNumber": "IN147258369",
  "nationality": "Indian",
  "dateOfBirth": "1980-09-05",
  "address": "Unit 2205, 1234 Very Long Street Name Avenue, Building C, North York, Toronto, Ontario M2N 5V8, Canada",
  "immigrationType": "express-entry",
  "notes": "CRS Score: 475 | NOC: 2173 (Software Engineer) | Language: IELTS 8.5"
}

### ========================================
### Test 10: Create Client - Minimal Data
### Test with only required fields
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Min Data",
  "email": "minimal@example.com",
  "phone": "+1-416-555-0010"
}

### ========================================
### Verification Tests
### ========================================

### Test 11: Get All Clients
### Verify clients were created in database
GET {{baseUrl}}/clients

### ========================================
### Test 12: Get Single Client by ID
### Replace {clientId} with actual ID from previous response
### ========================================
# GET {{baseUrl}}/clients/{clientId}

### ========================================
### Test 13: Get Recent Clients
### Check what admin sees in dashboard
### ========================================
GET {{baseUrl}}/admin/clients/recent?limit=10

### ========================================
### Test 14: Get Dashboard Stats
### Verify client count increased
### ========================================
GET {{baseUrl}}/admin/dashboard

### ========================================
### Error Handling Tests
### ========================================

### Test 15: Duplicate Email
### Should return 400 or 409 error
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Duplicate Test",
  "email": "john.doe@example.com",
  "phone": "+1-416-555-9999"
}

### ========================================
### Test 16: Invalid Email Format
### Should return 400 validation error
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Invalid Email",
  "email": "not-an-email",
  "phone": "+1-416-555-9998"
}

### ========================================
### Test 17: Missing Required Fields
### Should return 400 validation error
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "phone": "+1-416-555-9997"
}

### ========================================
### Test 18: Invalid Date Format
### Should return 400 validation error
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Invalid Date",
  "email": "invalid.date@example.com",
  "phone": "+1-416-555-9996",
  "dateOfBirth": "invalid-date"
}

### ========================================
### Performance Tests
### ========================================

### Test 19: Rapid Creation Test
### Create 5 clients quickly to test rate limiting
### (Run these in sequence)
### ========================================
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rapid Test 1",
  "email": "rapid1@example.com",
  "phone": "+1-416-555-1001"
}

###
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rapid Test 2",
  "email": "rapid2@example.com",
  "phone": "+1-416-555-1002"
}

###
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rapid Test 3",
  "email": "rapid3@example.com",
  "phone": "+1-416-555-1003"
}

###
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rapid Test 4",
  "email": "rapid4@example.com",
  "phone": "+1-416-555-1004"
}

###
POST {{baseUrl}}/clients
Content-Type: {{contentType}}

{
  "name": "Rapid Test 5",
  "email": "rapid5@example.com",
  "phone": "+1-416-555-1005"
}

### ========================================
### Google Sheets Specific Tests
### ========================================

### Test 20: Verify Header Row Creation
### First client should trigger header row creation
### Check your spreadsheet for:
### - Client ID | Name | Email | Phone | etc.
### ========================================

### Test 21: Check Data Formatting in Sheets
### After running tests, verify in Google Sheets:
### - Dates are formatted correctly
### - Boolean values show as "Yes/No"
### - All special characters display properly
### - No truncation of long text
### ========================================

### ========================================
### Expected Results in Google Sheets:
### ========================================
### 
### After running all tests, your spreadsheet should have:
### - 1 header row
### - ~15-20 data rows (from successful tests)
### - Properly formatted columns
### - No duplicate emails (some tests should fail)
### 
### Columns in order:
### 1. Client ID (UUID)
### 2. Name
### 3. Email
### 4. Phone
### 5. Passport Number
### 6. Nationality
### 7. Date of Birth (formatted as date)
### 8. Address
### 9. Immigration Type
### 10. Validated (Yes/No)
### 11. Created At (timestamp)
### 
### ========================================

### ========================================
### Manual Verification Checklist:
### ========================================
### 
### After running tests, verify:
### 
### ✅ Backend Console Shows:
###    - "Data sent to Google Sheets for client: [Name]"
###    - No errors about authentication
###    - No 401/404 errors
### 
### ✅ Database (PostgreSQL):
###    - Run: SELECT COUNT(*) FROM "Client";
###    - Should match number of successful POST requests
### 
### ✅ Google Sheets:
###    - New rows appear within 1-2 seconds
###    - All data matches POST request
###    - No missing or corrupted data
###    - Special characters display correctly
###    - Dates formatted as dates, not strings
### 
### ✅ Admin Dashboard (http://localhost:3001):
###    - Client count increases
###    - New clients appear in recent list
###    - Real-time notifications work
### 
### =====================================